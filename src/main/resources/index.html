<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Auth Center</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .login-container {
            background: white;
            width: 420px;
            padding: 40px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }

        /* Tab 样式 - 支持滚动 */
        .tabs-wrapper {
            position: relative;
            margin-bottom: 30px;
        }

        .tabs {
            display: flex;
            overflow-x: auto;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE */
            border-bottom: 1px solid #e0e0e0;
            padding-inline: 16px;
        }

        .tabs::-webkit-scrollbar {
            display: none; /* Chrome */
        }

        .tab-btn {
            flex-shrink: 0;
            padding: 12px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            color: #666;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
        }

        .tab-btn:hover {
            color: #c45a3b;
        }

        .tab-btn.active {
            color: #c45a3b;
            border-bottom-color: #c45a3b;
        }

        /* 滚动箭头 */
        .scroll-btn {
            position: absolute;
            top: 0;
            bottom: 1px;
            width: 30px;
            border: none;
            background: linear-gradient(90deg, white 60%, transparent);
            cursor: pointer;
            font-size: 16px;
            color: #999;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .scroll-btn:hover {
            color: #c45a3b;
        }

        .scroll-btn.left {
            left: 0;
            background: linear-gradient(90deg, white 60%, transparent);
        }

        .scroll-btn.right {
            right: 0;
            background: linear-gradient(-90deg, white 60%, transparent);
        }

        .tabs-wrapper.scrollable .scroll-btn {
            display: flex;
        }

        /* 标题 */
        .login-title {
            text-align: center;
            font-size: 24px;
            color: #333;
            margin-bottom: 8px;
        }

        .login-subtitle {
            text-align: center;
            font-size: 13px;
            color: #999;
            margin-bottom: 30px;
        }

        /* 表单内容 */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }

        .form-group input[type="text"],
        .form-group input[type="password"] {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #c45a3b;
        }

        /* 密码框 */
        .password-wrapper {
            position: relative;
        }

        .password-wrapper input {
            padding-right: 45px;
        }

        .toggle-pwd {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toggle-pwd svg {
            width: 20px;
            height: 20px;
            color: #999;
        }

        .toggle-pwd:hover svg {
            color: #c45a3b;
        }

        /* 显示密码复选框 */
        .show-pwd-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            margin-bottom: 25px;
        }

        .show-pwd-row input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .show-pwd-row span {
            font-size: 14px;
            color: #333;
        }

        /* 登录按钮 */
        .login-btn {
            width: 100%;
            padding: 14px;
            background: #c45a3b;
            color: white;
            border: none;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            border-radius: 6px;
        }

        .login-btn:hover {
            background: #a94a2e;
        }

        /* 底部 */
        .footer {
            text-align: center;
            margin-top: 25px;
            color: #999;
            font-size: 13px;
        }

        .footer a {
            color: #666;
            text-decoration: none;
        }

        .footer a:hover {
            color: #c45a3b;
        }
    </style>
</head>
<body>

<div class="login-container">
    <!-- Tab 区域 -->
    <div class="tabs-wrapper" id="tabsWrapper">
        <button class="scroll-btn left" onclick="scrollTabs(-1)">‹</button>
        <div class="tabs" id="tabButtons">
            <!-- 动态生成 -->
        </div>
        <button class="scroll-btn right" onclick="scrollTabs(1)">›</button>
    </div>

    <!-- Tab 内容 -->
    <div id="tabContents"></div>

    <!-- 底部 -->
    <div class="footer">
        <a href="#">Auth Center</a>
    </div>
</div>

<script>
    // 页面加载
    window.onload = function () {
        fetchSystems();
    }

    // 获取系统列表
    async function fetchSystems() {
        try {
            const res = await fetch('/api/systems');
            const systems = await res.json();
            renderTabs(systems);
        } catch (err) {
            // 模拟 10 个域
            const mockData = [
                {id: 1, name: 'LDAP 认证', key: 'ldap', description: '使用域账号登录'},
                {id: 2, name: 'OA 系统', key: 'oa', description: '办公自动化系统'},
                {id: 3, name: 'ERP 系统', key: 'erp', description: '企业资源管理'},
                {id: 4, name: 'HR 系统', key: 'hr', description: '人力资源管理'},
                {id: 5, name: 'CRM 系统', key: 'crm', description: '客户关系管理'},
                {id: 6, name: '邮件系统', key: 'mail', description: '企业邮箱登录'},
                {id: 7, name: '财务系统', key: 'finance', description: '财务管理系统'},
                {id: 8, name: 'MES 系统', key: 'mes', description: '生产执行系统'},
                {id: 9, name: 'PLM 系统', key: 'plm', description: '产品生命周期'},
                {id: 10, name: 'WMS 系统', key: 'wms', description: '仓储管理系统'}
            ];
            renderTabs(mockData);
        }
    }

    // 渲染 Tab 和表单
    function renderTabs(systems) {
        const tabButtons = document.getElementById('tabButtons');
        const tabContents = document.getElementById('tabContents');

        // 生成 Tab 按钮
        tabButtons.innerHTML = systems.map((sys, index) => `
    <button class="tab-btn ${index === 0 ? 'active' : ''}"
            data-key="${sys.key}"
            onclick="switchTab('${sys.key}', this)">
      ${sys.name}
    </button>
  `).join('');

        // 生成表单内容
        tabContents.innerHTML = systems.map((sys, index) => `
    <div class="tab-content ${index === 0 ? 'active' : ''}" id="tab-${sys.key}">
      <h2 class="login-title">${sys.name}</h2>
      <p class="login-subtitle">${sys.description}</p>

      <form onsubmit="handleLogin(event, '${sys.key}')">
        <div class="form-group">
          <label>用户名</label>
          <input type="text"
                 id="username-${sys.key}"
                 placeholder="输入用户名"
                 required>
        </div>

        <div class="form-group">
          <label>密码</label>
          <div class="password-wrapper">
            <input type="password"
                   id="password-${sys.key}"
                   placeholder="输入密码"
                   required>
            <button type="button" class="toggle-pwd" onclick="togglePassword('${sys.key}')">
              <svg id="eye-${sys.key}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            </button>
          </div>
        </div>


        <button type="submit" class="login-btn">登录</button>
      </form>
    </div>
  `).join('');

        // 检查是否需要滚动箭头
        checkScrollable();
    }

    // 检查 Tab 是否可滚动
    function checkScrollable() {
        const wrapper = document.getElementById('tabsWrapper');
        const tabs = document.getElementById('tabButtons');

        if (tabs.scrollWidth > tabs.clientWidth) {
            wrapper.classList.add('scrollable');
        } else {
            wrapper.classList.remove('scrollable');
        }
    }

    // 滚动 Tab
    function scrollTabs(direction) {
        const tabs = document.getElementById('tabButtons');
        tabs.scrollBy({
            left: direction * 120,
            behavior: 'smooth'
        });
    }

    // 切换 Tab
    function switchTab(key, btn) {
        // 切换按钮状态
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        // 切换内容
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(`tab-${key}`).classList.add('active');

        // 滚动让当前 tab 可见
        btn.scrollIntoView({behavior: 'smooth', inline: 'center', block: 'nearest'});
    }

    // 切换密码显示
    function togglePassword(key) {
        const pwdInput = document.getElementById(`password-${key}`);
        const checkbox = document.getElementById(`showPwd-${key}`);
        const eyeIcon = document.getElementById(`eye-${key}`);

        const isPassword = pwdInput.type === 'password';
        pwdInput.type = isPassword ? 'text' : 'password';
        checkbox.checked = isPassword;

        // 切换图标
        if (isPassword) {
            eyeIcon.innerHTML = `
      <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
      <line x1="1" y1="1" x2="23" y2="23"></line>
    `;
        } else {
            eyeIcon.innerHTML = `
      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
      <circle cx="12" cy="12" r="3"></circle>
    `;
        }
    }

    // 处理登录
    async function handleLogin(event, systemkey) {
        event.preventDefault();

        const username = document.getElementById(`username-${systemkey}`).value;
        const password = document.getElementById(`password-${systemkey}`).value;

        try {
            const res = await fetch(`/api/oauth2/${systemkey}/login`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username, password})
            });

            const data = await res.json();

            if (data.success) {
                alert('登录成功！');
            } else {
                alert('登录失败：' + data.message);
            }
        } catch (err) {
            alert('登录请求已发送（测试模式）');
        }
    }

    // 窗口大小变化时重新检查滚动
    window.onresize = checkScrollable;
</script>

</body>
</html>